<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>macro-basics</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<div id="toc">
<h2><a href="index.html">主頁</a></h2>

<div class="toc-container">
<div class="toc">
<ul>
<li><a href="#imagej-macro">ImageJ Macro語言基礎</a><ul>
<li><a href="#_1">簡介</a></li>
<li><a href="#_2">基礎語法</a><ul>
<li><a href="#_3">變量與數據類型</a></li>
<li><a href="#_4">運算符與表達式</a></li>
</ul>
</li>
<li><a href="#_5">控制結構</a><ul>
<li><a href="#_6">條件語句</a></li>
<li><a href="#_7">循環結構</a></li>
</ul>
</li>
<li><a href="#_8">函數與過程</a><ul>
<li><a href="#_9">函數定義</a></li>
<li><a href="#_10">內建函數</a></li>
</ul>
</li>
<li><a href="#_11">影像處理命令</a><ul>
<li><a href="#_12">基本命令</a></li>
<li><a href="#_13">選區操作</a></li>
</ul>
</li>
<li><a href="#_14">實用技巧</a><ul>
<li><a href="#_15">錯誤處理</a></li>
<li><a href="#_16">調試技巧</a></li>
</ul>
</li>
<li><a href="#_17">最佳實踐</a><ul>
<li><a href="#_18">代碼組織</a></li>
<li><a href="#_19">性能優化</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

</div>
</div>

<div id="content">
<h1 id="imagej-macro">ImageJ Macro語言基礎</h1>
<h2 id="_1">簡介</h2>
<p>ImageJ Macro語言是一種專門為影像處理設計的腳本語言，能夠自動化執行各種影像分析任務。本章將介紹Macro語言的基本語法和使用方法。</p>
<h2 id="_2">基礎語法</h2>
<h3 id="_3">變量與數據類型</h3>
<ol>
<li>基本類型
   ```
   // 數值類型
   var number = 123;
   var decimal = 3.14;</li>
</ol>
<p>// 字符串
   var text = "Hello ImageJ";</p>
<p>// 數組
   var array = newArray(1, 2, 3, 4, 5);
   ```</p>
<ol>
<li>特殊變量</li>
<li>影像ID</li>
<li>選區座標</li>
<li>測量結果</li>
<li>系統參數</li>
</ol>
<h3 id="_4">運算符與表達式</h3>
<ol>
<li>算術運算
   ```
   // 基本運算
   sum = a + b;
   difference = a - b;
   product = a * b;
   quotient = a / b;</li>
</ol>
<p>// 複合運算
   x += 1;
   y *= 2;
   ```</p>
<ol>
<li>邏輯運算
   ```
   // 比較運算
   if (value &gt; threshold) {
       print("Above threshold");
   }</li>
</ol>
<p>// 邏輯組合
   if (x &gt; 0 &amp;&amp; y &lt; 100) {
       print("Within range");
   }
   ```</p>
<h2 id="_5">控制結構</h2>
<h3 id="_6">條件語句</h3>
<ol>
<li>
<p>if-else結構
   <code>if (condition) {
       // 執行代碼
   } else {
       // 替代代碼
   }</code></p>
</li>
<li>
<p>switch-case結構
   <code>switch (value) {
       case 1:
           // 代碼1
           break;
       case 2:
           // 代碼2
           break;
       default:
           // 默認代碼
   }</code></p>
</li>
</ol>
<h3 id="_7">循環結構</h3>
<ol>
<li>for循環
   ```
   // 基本for循環
   for (i = 0; i &lt; 10; i++) {
       print(i);
   }</li>
</ol>
<p>// 數組遍歷
   for (i = 0; i &lt; array.length; i++) {
       print(array[i]);
   }
   ```</p>
<ol>
<li>while循環
   ```
   // while循環
   while (condition) {
       // 循環代碼
   }</li>
</ol>
<p>// do-while循環
   do {
       // 循環代碼
   } while (condition);
   ```</p>
<h2 id="_8">函數與過程</h2>
<h3 id="_9">函數定義</h3>
<ol>
<li>
<p>基本函數
   <code>function myFunction(parameter) {
       // 函數代碼
       return result;
   }</code></p>
</li>
<li>
<p>過程定義
   <code>function processImage() {
       // 影像處理代碼
   }</code></p>
</li>
</ol>
<h3 id="_10">內建函數</h3>
<ol>
<li>影像操作
   ```
   // 獲取影像信息
   width = getWidth();
   height = getHeight();</li>
</ol>
<p>// 像素操作
   value = getPixel(x, y);
   setPixel(x, y, value);
   ```</p>
<ol>
<li>用戶交互
   ```
   // 對話框
   Dialog.create("Input");
   Dialog.addNumber("Value:", 0);
   Dialog.show();</li>
</ol>
<p>// 文件選擇
   file = File.openDialog("Select a file");
   ```</p>
<h2 id="_11">影像處理命令</h2>
<h3 id="_12">基本命令</h3>
<ol>
<li>影像操作
   ```
   // 打開影像
   open(path);</li>
</ol>
<p>// 保存影像
   saveAs("Tiff", path);</p>
<p>// 關閉影像
   close();
   ```</p>
<ol>
<li>處理命令
   ```
   // 影像增強
   run("Enhance Contrast...", "saturated=0.35");</li>
</ol>
<p>// 濾波處理
   run("Gaussian Blur...", "sigma=2");
   ```</p>
<h3 id="_13">選區操作</h3>
<ol>
<li>ROI操作
   ```
   // 創建選區
   makeRectangle(x, y, width, height);</li>
</ol>
<p>// 添加到ROI管理器
   roiManager("Add");</p>
<p>// 選擇ROI
   roiManager("Select", index);
   ```</p>
<ol>
<li>測量操作
   ```
   // 設置測量參數
   run("Set Measurements...", "area mean standard");</li>
</ol>
<p>// 執行測量
   run("Measure");
   ```</p>
<h2 id="_14">實用技巧</h2>
<h3 id="_15">錯誤處理</h3>
<ol>
<li>
<p>異常捕獲
   <code>try {
       // 可能出錯的代碼
   } catch (err) {
       print("Error: " + err);
   }</code></p>
</li>
<li>
<p>錯誤檢查
   ```
   // 檢查影像是否打開
   if (nImages == 0) {
       exit("No image open");
   }</p>
</li>
</ol>
<p>// 檢查選區
   if (selectionType == -1) {
       exit("No selection");
   }
   ```</p>
<h3 id="_16">調試技巧</h3>
<ol>
<li>打印調試
   ```
   // 打印變量
   print("Debug: " + variable);</li>
</ol>
<p>// 打印數組
   Array.print(array);
   ```</p>
<ol>
<li>日誌記錄
   ```
   // 寫入日誌
   File.append(message, "log.txt");</li>
</ol>
<p>// 顯示進度
   showProgress(current, total);
   ```</p>
<h2 id="_17">最佳實踐</h2>
<h3 id="_18">代碼組織</h3>
<ol>
<li>模塊化
   ```
   // 主函數
   macro "Main" {
       initialize();
       processImages();
       cleanup();
   }</li>
</ol>
<p>// 輔助函數
   function initialize() {
       // 初始化代碼
   }
   ```</p>
<ol>
<li>註釋規範
   ```
   // 單行註釋</li>
</ol>
<p>/<em> 多行註釋
      說明代碼功能
      參數含義等 </em>/
   ```</p>
<h3 id="_19">性能優化</h3>
<ol>
<li>批處理模式
   ```
   // 開啟批處理
   setBatchMode(true);</li>
</ol>
<p>// 處理代碼</p>
<p>// 關閉批處理
   setBatchMode(false);
   ```</p>
<ol>
<li>記憶體管理
   ```
   // 清理記憶體
   run("Collect Garbage");</li>
</ol>
<p>// 關閉未使用的窗口
   if (isOpen("Results")) {
       selectWindow("Results");
       run("Close");
   }
   ``` </p>
</div>

<!-- 如果需要使用 Mermaid JS，請取消註解以下代碼並確保 Mermaid JS 已正確安裝 -->
<!-- Mermaid 是一個用於生成圖表和流程圖的 JavaScript 庫。 -->
<!-- 官方文件: https://mermaid-js.github.io/mermaid/#/ -->
<script type="module">
  // 初始化 Mermaid JS，啟用自動渲染
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
  // 設定 Mermaid 的配置
  mermaid.initialize({
    startOnLoad: true,
    theme: 'neutral',
    flowchart: {
      curve: 'linear'
    },
    sequence: {
      actorFontSize: 16,
      actorMargin: 10,
      boxTextMargin: 6,
      noteMargin: 10,
      messageMargin: 10
    }
  });  

  // 自動渲染所有的 Mermaid 圖表
  mermaid.run({ nodes: document.querySelectorAll('.language-mermaid') });

</script>

</body>
</html>
