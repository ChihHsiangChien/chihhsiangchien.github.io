<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>fft</title>
<link rel="stylesheet" href="styles.css">
<!-- KaTeX CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
</head>
<body>

<div id="toc">
<h2><a href="index.html">回到首頁</a></h2>
<div class="toc-container">
<div class="toc">
<ul>
<li><a href="#imagejfft">ImageJ：週期性雜訊與傅立葉轉換（FFT）</a><ul>
<li><a href="#fft">FFT 結果觀察</a></li>
<li><a href="#_1">實作範例</a></li>
<li><a href="#fft_1">在 FFT 頻譜上處理並反轉回空間域</a><ul>
<li><a href="#_2">流程</a></li>
</ul>
</li>
<li><a href="#_4">原理解釋</a></li>
<li><a href="#_5">自訂濾波器</a></li>
<li><a href="#fft_2">FFT 自相關</a></li>
</ul>
</li>
</ul>
</div>

</div>
</div>
<div id="content">
<h1 id="imagejfft">ImageJ：週期性雜訊與傅立葉轉換（FFT）</h1>
<p>本範例展示如何在影像中加入週期性雜訊（條紋或點狀 pattern），並利用 ImageJ 觀察其傅立葉轉換（FFT）結果。</p>
<hr />
<h2 id="fft">FFT 結果觀察</h2>
<ul>
<li><strong>條紋雜訊（stripe）</strong>：<br />
  頻譜圖會出現一對明顯的亮點，位置與條紋方向、頻率有關。</li>
<li><strong>點狀 pattern</strong>：<br />
  頻譜圖會出現多個亮點，形成規則的格點分布。</li>
<li>調整 <code>angle</code> 參數，可觀察頻譜亮點的旋轉變化。</li>
<li>調整 <code>freqX</code> 參數，可觀察頻譜亮點的位置變化。</li>
</ul>
<hr />
<h2 id="_1">實作範例</h2>
<pre><code class="language-ijm">// 在影像上增加週期性雜訊：可切換「條紋」或「點狀 pattern」
// 觀察轉出的FFT


// ==== 參數 ====
mode = &quot;stripe&quot;; // &quot;stripe&quot; = 條紋, &quot;pattern&quot; = 點狀
// 條紋時只用 freqX
freqX = 10;       // X方向週期
freqY = 20;       // Y方向週期
amp   = 60;       // 雜訊強度 (0~255)
angle = 30;       // 旋轉角度 (度數)

// ==== 測試影像 ====
run(&quot;Clown&quot;);
run(&quot;8-bit&quot;);
rename(&quot;Noisy&quot;);

width = getWidth();
height = getHeight();
theta = angle * PI / 180;

setBatchMode(true);

for (y=0; y&lt;height; y++) {
    for (x=0; x&lt;width; x++) {

        // 旋轉座標
        xp =  x * cos(theta) + y * sin(theta);
        yp = -x * sin(theta) + y * cos(theta);

        if (mode == &quot;stripe&quot;) {
            // 條紋
            value = amp * sin(2 * PI * xp / freqX);
        } else {
            // 點狀 pattern
            value = amp * sin(2 * PI * xp / freqX) * sin(2 * PI * yp / freqY);
        }

        // 只增亮
        //if (value &lt; 0) value = 0;

        v = getPixel(x, y) + value;

        if (v &gt; 255) v = 255;
        if (v &lt; 0) v = 0;
        setPixel(x, y, v);
    }
}

setBatchMode(false);
resetMinAndMax();
run(&quot;FFT&quot;);
</code></pre>
<hr />
<h2 id="fft_1">在 FFT 頻譜上處理並反轉回空間域</h2>
<p>你可以在 FFT 頻譜圖上進行處理（如遮罩、消除亮點），再做 Inverse FFT（<code>Process › FFT › Inverse FFT</code>）觀察效果。</p>
<h3 id="_2">流程</h3>
<ol>
<li><strong>產生含週期性雜訊的影像並做 FFT</strong>（同前述腳本）。</li>
<li><strong>手動或自動在 FFT 頻譜圖上遮罩亮點</strong>（消除雜訊頻率）。</li>
<li><strong>執行 Inverse FFT</strong>，觀察雜訊是否被移除。</li>
</ol>
<h4 id="_3">補充說明</h4>
<ul>
<li>你可以手動用橢圓工具在 FFT 頻譜圖上選取亮點，然後執行 <code>Edit &gt; Clear</code> 或 <code>Clear Outside</code>。</li>
<li>遮罩掉亮點後再做 <code>Process &gt; FFT &gt; Inverse FFT</code>，即可看到雜訊被抑制的效果。</li>
</ul>
<hr />
<h2 id="_4">原理解釋</h2>
<p>在頻域中，週期性雜訊會對應到特定的頻率成分。透過傅立葉轉換，我們可以將影像從<strong>空間域</strong>轉換到<strong>頻域</strong>，並觀察到這些雜訊成分的頻譜特徵。當我們在頻譜圖上進行遮罩處理，實際上是去除了這些特定頻率的影響，進而達到去雜訊的效果。</p>
<hr />
<h2 id="_5">自訂濾波器</h2>
<p>從 FFT 頻譜圖上，你也可以使用自訂濾波器來處理影像。這可以讓你更精確地控制哪些頻率成分被保留或去除。<br />
執行 <code>Process › FFT › Custom Filter...</code>。</p>
<hr />
<h2 id="fft_2">FFT 自相關</h2>
<p>透過自相關分析，我們可以進一步了解影像中的週期性雜訊特徵。自相關函數可以幫助我們識別影像中重複出現的模式，並為去雜訊提供依據。</p>
<ol>
<li>使用一個有週期性條紋的圖，或是洋蔥細胞顯微圖做 FFT，再使用 <code>Process › FFT › FD Math...</code>，使用同一張圖做自相關運算 <code>correlate</code>，勾選 <code>Do inverse transform</code>。</li>
<li>觀察自相關結果，會顯示出影像中週期性條紋的特徵。</li>
</ol>
</div>

<!-- Mermaid JS -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
  mermaid.initialize({}); // Keep double braces for literal JS object
  mermaid.run({ nodes: document.querySelectorAll('.language-mermaid') }); // Keep double braces
</script>

<!-- KaTeX JS -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script>
<!-- *** CORRECTED SCRIPT WITH ${...} ESCAPING *** -->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                renderMathInElement(document.body, {
                    delimiters: [
                        { left: '$$',  right: '$$',  display: true },
                        { left: '\\[', right: '\\]', display: true },
                        { left: '\\(', right: '\\)', display: false }
                    ],
                    ignoredTags: ['script','noscript','style','textarea','pre','code'],
                    throwOnError: false
                });
            });
        </script>

</body>
</html>
