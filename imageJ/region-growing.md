# 互動式標記控制的分水嶺分割 (Interactive Marker-controlled Watershed)

本文件說明 ImageJ/Fiji 插件 `Plugins › MorphoLibJ › Segmentation › Interactive Marker-controlled Watershed` 的使用方法，特別是針對 `Compactness`（緊湊度）與 `Calculate Dams`（計算分水嶺線）這兩個關鍵參數的解釋。

## 基本操作流程
0.  在`Help > Update...`點選` Manage update sites. `，輸入`IJPB-plugins`安裝`MorphoLibJ`。
1.  在影像上使用 **Point Tool**、**Multi-point Tool** 或任何選取工具，標示出您感興趣的物件（作為「種子點」）。
2.  將這些標記加入 **ROI Manager** (`Analyze > Tools > ROI Manager...`)。
3.  在 ROI Manager 視窗中，**選取**所有要作為種子點的 ROI。
4.  啟動插件：`Plugins › MorphoLibJ › Segmentation › Interactive Marker-controlled Watershed`。

---

## 參數詳解

### 1. 緊湊度 (Compactness)

此參數用來控制分割結果中各區域（集水盆地）的形狀規則性，數值範圍從 0 開始。

#### `Compactness = 0` (傳統分水嶺)
- **行為：** 執行傳統的、完全基於梯度（影像邊緣）的分水嶺演算法。
- **結果：** 分割線會嚴格沿著影像中梯度最強的路徑，因此產生的區域形狀可能非常不規則，完全由影像內容決定。

#### `Compactness > 0` (緊湊分水嶺)
- **行為：** 啟用「緊湊分水嶺」演算法，在分割過程中加入形狀約束，鼓勵產生的區域更圓滑、更緊湊。
- **結果：**
    - **值越大，形狀越規則：** 較大的緊湊度值會使分割區域更接近圓形或凸形，邊界更平滑。
    - **抑制雜訊：** 對於有雜訊或邊緣不清晰的影像，適當的緊湊度有助於獲得更連貫、視覺上更平滑的分割結果。
    - **潛在風險：** 過高的值可能導致過度平滑，使分割結果失去物件的真實細節，甚至將相鄰物件錯誤地合併。

#### 如何選擇合適的緊湊度？

選擇最佳值通常需要反覆試驗，原則如下：

1.  **從 `0` 開始：** 先以傳統分水嶺的結果作為基準，觀察區域是否過於破碎或邊緣鋸齒嚴重。
2.  **逐步增加：** 如果物件預期是規則形狀，或結果受雜訊影響嚴重，可逐步增加緊湊度（如 0.1, 0.5, 1.0...），並觀察變化。
3.  **視覺評估是關鍵：**
    - **過小：** 結果可能不夠平滑，充滿小而分散的區域。
    - **適中：** 區域邊緣變得平滑規整，同時保留了物件的主要細節。
    - **過大：** 結果過於圓滑，可能導致欠分割（物件被合併）或細節丟失。
4.  **考慮影像特性：**
    - **高雜訊影像：** 適當的緊湊度（如 0.5 ~ 2.0）有助於消除假邊緣。
    - **複雜形狀物件：** 若物件本身形狀不規則，應使用較小的緊湊度，以避免過度簡化其真實輪廓。

---

### 2. 計算分水嶺線 (Calculate Dams)

此功能決定是否在分割出的不同區域之間產生明確的「分水嶺線」（Dams）。

- **地形學比喻：**
    - **集水盆地 (Catchment Basins):** 影像中的同質區域（如物件內部）。
    - **分水嶺線/壩 (Watershed Lines/Dams):** 分隔不同盆地的山脊，對應影像中梯度最高的邊界。

#### 啟用 "Calculate Dams"
- **結果：** 在不同區域之間會產生一條單像素寬的邊界線（即「壩」）。
- **優點：**
    - **視覺化邊界：** 清晰地顯示每個物件的精確輪廓。
    - **區分相鄰物件：** 明確劃分緊密相鄰的物件。
    - **利於後續分析：** 方便進行周長測量或拓撲分析。

#### 禁用 "Calculate Dams"
- **結果：** 只會產生一個個填滿顏色的區域，區域之間直接相鄰，沒有邊界線。
- **優點：**
    - **簡化數據：** 當你只關心每個區域的標籤和屬性（如面積、平均強度），而不需要邊界線時，結果更簡潔。
    - **避免額外像素：** 分割結果只包含物件本身，沒有額外的邊界線像素。

