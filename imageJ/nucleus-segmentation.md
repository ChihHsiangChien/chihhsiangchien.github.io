# 細胞核分割實作

## 簡介
細胞核分割是生物醫學影像分析中的關鍵步驟，對於細胞計數、形態分析和表型分析至關重要。本章將介紹多種細胞核分割方法及其實際應用。

## 基於閾值的分割

### 自動閾值法
1. Otsu方法
   - 原理：最大化類間方差
   - 適用場景：高對比度影像
   - 操作步驟：
     * `Image > Adjust > Threshold`
     * 選擇 "Otsu" 方法
     * 應用閾值

2. Triangle方法
   - 原理：幾何距離最大化
   - 適用場景：單峰直方圖
   - 操作步驟：
     * `Image > Adjust > Threshold`
     * 選擇 "Triangle" 方法
     * 調整參數

### 局部閾值法
1. 自適應閾值
   - 原理：局部區域統計
   - 參數設定：
     * 窗口大小
     * 偏移值
   - 應用場景：不均勻照明

2. 多級閾值
   - 分層分割
   - 多類別區分
   - 結果合併

## 基於機器學習的分割

### StarDist
1. 模型原理
   - 星形物件檢測
   - 距離預測
   - 物件中心定位

2. 使用流程
   - 模型載入
   - 參數配置
   - 預測執行
   - 結果後處理

### Trainable Weka Segmentation
1. 特徵提取
   - 紋理特徵
   - 邊緣特徵
   - 形狀特徵

2. 訓練過程
   - 標記訓練樣本
   - 特徵選擇
   - 分類器訓練
   - 模型評估

## 分割後處理

### 形態學操作
1. 開運算（Opening）
   - 去除小物件
   - 平滑邊界

2. 閉運算（Closing）
   - 填充小孔
   - 連接斷裂區域

### 物件篩選
1. 大小篩選
   - 面積範圍設定
   - 周長限制
   - 圓形度評估

2. 形狀篩選
   - 長寬比
   - 圓形度
   - 凸度

## 實作範例

### 範例 1：熒光顯微鏡影像分割
1. 前處理
   ```
   run("Gaussian Blur...", "sigma=2");
   run("Enhance Contrast...", "saturated=0.35");
   ```

2. 分割步驟
   ```
   setAutoThreshold("Otsu dark");
   setOption("BlackBackground", true);
   run("Convert to Mask");
   ```

3. 後處理
   ```
   run("Fill Holes");
   run("Watershed");
   run("Analyze Particles...", "size=50-Infinity circularity=0.5-1.00 show=Outlines");
   ```

### 範例 2：多通道影像分割
1. 通道分離
   ```
   run("Split Channels");
   selectWindow("C1-image");
   ```

2. 每個通道分割
   - DAPI通道：細胞核
   - GFP通道：目標蛋白
   - RFP通道：細胞器

3. 結果合併
   ```
   run("Merge Channels...", "c1=mask1 c2=mask2 c3=mask3");
   ```

## 分割結果分析

### 定量分析
1. 基本測量
   - 數量統計
   - 大小分布
   - 形態參數

2. 空間分析
   - 細胞核分布
   - 密度計算
   - 聚集程度

### 結果驗證
1. 人工檢查
   - 隨機抽樣
   - 邊界檢查
   - 分割質量評估

2. 定量評估
   - 準確率
   - 召回率
   - Dice係數

## 進階應用

### 時序分析
1. 追蹤分析
   - 細胞核運動
   - 分裂事件
   - 凋亡檢測

2. 動態變化
   - 形態變化
   - 強度變化
   - 位置變化

### 3D分析
1. Z-stack處理
   - 體積重建
   - 3D分割
   - 立體可視化

2. 3D測量
   - 體積計算
   - 表面積測量
   - 空間分布 