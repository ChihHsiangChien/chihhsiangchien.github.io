<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>imageProcess</title>
<link rel="stylesheet" href="styles.css">
<!-- KaTeX CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
</head>
<body>

<div id="toc">
<h2><a href="index.html">回到首頁</a></h2>
<div class="toc-container">
<div class="toc">
<ul>
<li><a href="#_1">影像前處理決策方法</a><ul>
<li><a href="#_2">流程總覽</a></li>
<li><a href="#1">1. 彩色影像轉灰階</a></li>
<li><a href="#2">2. 背景分離（前景/背景分割）</a></li>
<li><a href="#3">3. 對比度增強/亮度均勻化</a></li>
<li><a href="#4-workflow">4. 去雜訊（依 workflow 選擇）</a></li>
<li><a href="#5">5. 邊緣偵測</a></li>
<li><a href="#6">6. 邊緣細化/形態學操作</a></li>
<li><a href="#7">7. 輪廓分析/分割</a></li>
<li><a href="#8">8. 批次處理與自動化</a></li>
<li><a href="#workflow">常見細胞分析基本流程（Workflow）</a></li>
<li><a href="#6_1">6. 是否圖像角度或大小不一致？</a><ul>
<li><a href="#6-1-geometric-transformations">6-1. 幾何轉換 (Geometric Transformations)</a></li>
</ul>
</li>
<li><a href="#7_1">7. 是否要進行大量影像處理？</a><ul>
<li><a href="#7-1-batch-processing">7-1. 使用批次處理 (Batch Processing)</a></li>
<li><a href="#7-2-python-pyimagej">7-2. 使用 Python 自動化 (推薦 pyimagej)</a></li>
</ul>
</li>
<li><a href="#workflow_1">常見的細胞分析基本流程 (Workflow)</a></li>
</ul>
</li>
</ul>
</div>

</div>
</div>
<div id="content">
<h1 id="_1">影像前處理決策方法</h1>
<h2 id="_2">流程總覽</h2>
<p>根據 <a href="workflowChart.html">前處理流程圖</a>，主要步驟如下：
1. 彩色影像轉灰階
2. 背景分離（靜態/動態背景相減）
3. 對比度增強
4. 去雜訊（依雜訊類型選擇方法）
5. 邊緣偵測
6. 形態學操作
7. 輪廓分析/分割</p>
<hr />
<h2 id="1">1. 彩色影像轉灰階</h2>
<ul>
<li><strong>ImageJ 操作：</strong><ul>
<li><code>Image &gt; Type &gt; 8-bit</code> 或 <code>Image &gt; Type &gt; 16-bit</code>（將彩色影像轉為灰階）</li>
<li>若原始影像為 RGB，可用 <code>Image &gt; Type &gt; RGB Stack</code> 分離通道</li>
</ul>
</li>
</ul>
<hr />
<h2 id="2">2. 背景分離（前景/背景分割）</h2>
<ul>
<li><strong>靜態背景相減法：</strong><ul>
<li><code>Process &gt; Image Calculator...</code>，選擇原始影像與背景影像，運算方式選 <code>Subtract</code></li>
</ul>
</li>
<li><strong>動態背景建模：</strong><ul>
<li>若有影像序列，可用 <code>Process &gt; Subtract Background...</code>（設定 rolling ball 半徑）</li>
<li>進階：需外掛如 <code>Background Subtraction</code> 或用 Macro 處理多張影像</li>
</ul>
</li>
</ul>
<hr />
<h2 id="3">3. 對比度增強/亮度均勻化</h2>
<ul>
<li><strong>ImageJ 操作：</strong><ul>
<li><code>Image &gt; Adjust &gt; Brightness/Contrast...</code></li>
<li><code>Process &gt; Enhance Contrast...</code>（可勾選 Normalize/Equalize Histogram）</li>
<li><code>Process &gt; Subtract Background...</code>（校正不均勻背景）</li>
</ul>
</li>
</ul>
<hr />
<h2 id="4-workflow">4. 去雜訊（依 workflow 選擇）</h2>
<ul>
<li><strong>椒鹽雜訊/需保邊：</strong><ul>
<li><code>Process &gt; Filters &gt; Median...</code></li>
</ul>
</li>
<li><strong>高斯雜訊/平滑為主：</strong><ul>
<li><code>Process &gt; Filters &gt; Gaussian Blur...</code></li>
</ul>
</li>
<li><strong>強烈保邊（進階）：</strong><ul>
<li>需安裝 Bilateral Filter 插件（<code>Plugins &gt; Bilateral Filter</code>）</li>
</ul>
</li>
</ul>
<hr />
<h2 id="5">5. 邊緣偵測</h2>
<p>ImageJ 可利用 <code>Process &gt; Filters &gt; Convolve...</code> 自訂卷積核進行各種邊緣偵測。以下提供常用 kernel 範例：</p>
<ul>
<li>
<p><strong>Sobel（高對比）：</strong></p>
<ul>
<li>
<p>在 Convolve 視窗輸入：</p>
<p><code>1 0 -1
2 0 -2
1 0 -1</code></p>
</li>
<li>
<p>或</p>
<p><code>1 2 1
0 0 0
-1 -2 -1</code></p>
</li>
<li>
<p>分別為 X/Y 方向，需各自執行一次。</p>
</li>
</ul>
</li>
<li>
<p><strong>Scharr（高對比）：</strong></p>
<ul>
<li>
<p>在 Convolve 視窗輸入：</p>
<p><code>3 0 -3
10 0 -10
3 0 -3</code></p>
</li>
<li>
<p>或</p>
<p><code>3 10 3
0 0 0
-3 -10 -3</code></p>
</li>
<li>
<p>分別為 X/Y 方向，需各自執行一次。</p>
</li>
</ul>
</li>
<li>
<p><strong>Laplacian（找細節/斑點）：</strong></p>
<ul>
<li>
<p>在 Convolve 視窗輸入：</p>
<p><code>0 1 0
1 -4 1
0 1 0</code></p>
</li>
<li>
<p>或</p>
<p><code>1 1 1
1 -8 1
1 1 1</code></p>
</li>
</ul>
</li>
<li>
<p><strong>Canny（效果均衡）：</strong></p>
<ul>
<li>Canny 邊緣偵測需多步驟（高斯模糊 + Sobel + 非極大值抑制 +雙閾值），ImageJ 無直接 kernel，但可用 Convolve 先做高斯模糊與 Sobel，再手動後處理。</li>
</ul>
</li>
</ul>
<blockquote>
<p>操作步驟：<code>Process &gt; Filters &gt; Convolve...</code>，將上述 kernel 貼入視窗即可。</p>
</blockquote>
<hr />
<h2 id="6">6. 邊緣細化/形態學操作</h2>
<ul>
<li><strong>ImageJ 操作：</strong><ul>
<li><code>Process &gt; Binary &gt; Erode</code>（侵蝕）</li>
<li><code>Process &gt; Binary &gt; Dilate</code>（膨脹）</li>
<li><code>Process &gt; Binary &gt; Open</code>（開啟）</li>
<li><code>Process &gt; Binary &gt; Close</code>（關閉）</li>
<li><code>Process &gt; Binary &gt; Skeletonize</code>（骨架化）</li>
<li><code>Process &gt; Binary &gt; Watershed</code>（分水嶺分割）</li>
</ul>
</li>
</ul>
<hr />
<h2 id="7">7. 輪廓分析/分割</h2>
<ul>
<li><strong>ImageJ 操作：</strong><ul>
<li><code>Analyze &gt; Analyze Particles...</code>（偵測、量測分割後的物件）</li>
<li>可設定 Size/Circularity 範圍，並選擇輸出結果</li>
</ul>
</li>
</ul>
<hr />
<h2 id="8">8. 批次處理與自動化</h2>
<ul>
<li><strong>錄製 Macro：</strong><ul>
<li><code>Plugins &gt; Macros &gt; Record...</code> 開始錄製操作</li>
<li>完成後 <code>Create</code> 儲存 Macro</li>
</ul>
</li>
<li><strong>批次處理：</strong><ul>
<li><code>Process &gt; Batch &gt; Macro...</code>，選擇 Macro 與資料夾批次處理</li>
</ul>
</li>
</ul>
<hr />
<h2 id="workflow">常見細胞分析基本流程（Workflow）</h2>
<ol>
<li><strong>輸入影像</strong>：<code>File &gt; Open...</code></li>
<li><strong>去雜訊</strong>：<code>Process &gt; Filters &gt; Gaussian Blur...</code> 或 <code>Median...</code></li>
<li><strong>增強對比/亮度均勻化</strong>：<code>Process &gt; Enhance Contrast...</code>、<code>Subtract Background...</code></li>
<li><strong>門檻處理/分割</strong>：<code>Image &gt; Adjust &gt; Threshold...</code> 或安裝 <code>Auto Local Threshold</code> 插件</li>
<li><strong>形態學運算</strong>：<code>Process &gt; Binary &gt; ...</code></li>
<li><strong>粒子分析</strong>：<code>Analyze &gt; Analyze Particles...</code></li>
<li><strong>輸出數據</strong>：<code>File &gt; Save As...</code> 匯出結果</li>
</ol>
<h2 id="6_1">6. 是否圖像角度或大小不一致？</h2>
<h3 id="6-1-geometric-transformations">6-1. 幾何轉換 (Geometric Transformations)</h3>
<ul>
<li><strong>ImageJ 操作：</strong><ul>
<li><strong>旋轉：</strong> <code>Image &gt; Transform &gt; Rotate...</code></li>
<li><strong>縮放：</strong> <code>Image &gt; Transform &gt; Scale...</code></li>
<li><strong>翻轉：</strong> <code>Image &gt; Transform &gt; Flip Horizontally / Flip Vertically</code></li>
<li><strong>精確對齊：</strong> 使用 ROI 工具選取參考區域，再用 <code>Edit &gt; Selection &gt; Specify...</code> 設定精確座標或大小，輔助對齊。</li>
</ul>
</li>
</ul>
<hr />
<h2 id="7_1">7. 是否要進行大量影像處理？</h2>
<h3 id="7-1-batch-processing">7-1. 使用批次處理 (Batch Processing)</h3>
<ul>
<li><strong>ImageJ Macro 操作：</strong><ol>
<li><strong>錄製Macro：</strong> <code>Plugins &gt; Macros &gt; Record...</code> 開始錄製你的操作步驟。</li>
<li>完成操作後，在 Recorder 視窗點擊 <code>Create</code>。</li>
<li><strong>測試Macro：</strong> <code>Plugins &gt; Macros &gt; Run...</code> 選擇剛才儲存的Macro文件 (<code>.ijm</code>) 運行。</li>
<li><strong>批次處理：</strong> <code>Process &gt; Batch &gt; Macro...</code><ul>
<li>設定 <code>Input</code> 資料夾 (來源影像)。</li>
<li>設定 <code>Output</code> 資料夾 (儲存結果)。</li>
<li>選擇 <code>Macro</code> 文件。</li>
<li>設定輸出格式 (<code>Format</code>)。</li>
<li>點擊 <code>Process</code> 開始批次處理。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="7-2-python-pyimagej">7-2. 使用 Python 自動化 (推薦 <code>pyimagej</code>)</h3>
<h2 id="workflow_1">常見的細胞分析基本流程 (Workflow)</h2>
<ol>
<li>
<p><strong>輸入影像 (Image Input)</strong></p>
<ul>
<li>通常是顯微鏡影像。</li>
<li>格式可能是 <code>TIFF</code>, <code>JPG</code>, <code>PNG</code> 等，有時是多通道 (multi-channel) 或 Z-stack 影像。</li>
</ul>
</li>
<li>
<p><strong>去雜訊 (Noise Reduction)</strong></p>
<ul>
<li><code>Gaussian blur</code> (高斯模糊): 去除高頻雜訊，使背景平滑。適用於高斯分佈的雜訊。</li>
<li><code>Median filter</code> (中值濾波): 更適合消除 <code>salt-and-pepper noise</code> (椒鹽雜訊/雜點)。</li>
</ul>
</li>
<li>
<p><strong>增強對比/亮度均勻化 (Enhancement / Illumination Correction)</strong></p>
<ul>
<li><code>Histogram equalization</code> (直方圖均化): 全局性地增強對比度。</li>
<li><code>CLAHE</code> (Contrast Limited Adaptive Histogram Equalization): 自適應直方圖均衡，分區塊處理，對局部對比度改善更佳，尤其適用於亮度不均的影像。</li>
<li>背景減除 (<code>Process &gt; Subtract Background...</code>): 適用於背景緩慢變化的情況。</li>
</ul>
</li>
<li>
<p><strong>門檻處理/分割 (Thresholding / Segmentation)</strong></p>
<ul>
<li><strong>全局閾值 (Global Threshold):</strong> 整張影像使用同一個閾值。<ul>
<li><code>Image &gt; Adjust &gt; Threshold...</code> (可選 <code>Otsu</code>, <code>MaxEntropy</code> 等自動方法)。</li>
</ul>
</li>
<li><strong>局部閾值 (Local Threshold):</strong> 影像被分成小區域，每個區域計算自己的閾值。<ul>
<li>適用於背景亮度不均勻。</li>
<li>需插件如 <code>Auto Local Threshold</code> (提供 <code>Phansalkar</code>, <code>Bernsen</code>, <code>Mean</code>, <code>Median</code> 等方法)。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>形態學運算 (Morphological Operations)</strong></p>
<ul>
<li>主要在二值影像上操作 (<code>Process &gt; Binary &gt; ...</code>)。</li>
<li><code>Erosion</code> (侵蝕): 縮小物件，去除毛刺。</li>
<li><code>Dilation</code> (膨脹): 擴大物件，填補內部小孔。</li>
<li><code>Opening</code> (開啟): 先侵蝕後膨脹，可斷開細微連接、去除小噪點。</li>
<li><code>Closing</code> (關閉): 先膨脹後侵蝕，可連接鄰近物件、填補內部孔洞。</li>
<li><code>Watershed</code> 分水嶺分割: <code>Process &gt; Binary &gt; Watershed</code>，常用於分離相連或重疊的細胞。通常需要先進行距離變換 (<code>Process &gt; Binary &gt; Distance Map</code>)。</li>
</ul>
</li>
<li>
<p><strong>粒子分析 (Analyze Particles)</strong></p>
<ul>
<li><code>Analyze &gt; Analyze Particles...</code></li>
<li>在二值影像上偵測獨立的物件 (粒子/細胞)。</li>
<li>可設定大小 (Size) 和圓形度 (Circularity) 範圍來篩選目標。</li>
<li>測量參數包括：面積 (Area)、中心點 (Centroid)、周長 (Perimeter)、圓形度、長短軸等。</li>
<li>勾選 <code>Display results</code>, <code>Clear results</code>, <code>Summarize</code>, <code>Add to Manager</code> 等選項控制輸出。</li>
</ul>
</li>
<li>
<p><strong>輸出數據 (Data Output)</strong></p>
<ul>
<li>分析結果顯示在 ImageJ 的 <code>Results Table</code> 中。</li>
<li>可將表格 <code>File &gt; Save As...</code> 匯出成 <code>.csv</code> 或 <code>.txt</code> 文件，以便後續使用 Excel, Python (Pandas), R 等工具進行統計分析和繪圖。</li>
</ul>
</li>
</ol>
</div>

<!-- Mermaid JS -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
  mermaid.initialize({}); // Keep double braces for literal JS object
  mermaid.run({ nodes: document.querySelectorAll('.language-mermaid') }); // Keep double braces
</script>

<!-- KaTeX JS -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script>
<!-- *** CORRECTED SCRIPT WITH ${...} ESCAPING *** -->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                renderMathInElement(document.body, {
                    delimiters: [
                        { left: '$$',  right: '$$',  display: true },
                        { left: '\\[', right: '\\]', display: true },
                        { left: '\\(', right: '\\)', display: false }
                    ],
                    ignoredTags: ['script','noscript','style','textarea','pre','code'],
                    throwOnError: false
                });
            });
        </script>

</body>
</html>
