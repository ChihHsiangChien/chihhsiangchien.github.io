# 電路組裝練習（組裝模式 + 故障診斷）

## 互動規格

### 核心元件
- **四種元件類型**：電池(battery)、電線(wire)、燈座(socket)、燈泡(bulb)
- **視覺設計**：
  - 每種元件有專屬顏色（電池=藍、電線=琥珀、燈座=粉、燈泡=綠）
  - 插槽使用相同色相但較低彩度的顏色
  - 左上角顯示中文名稱，右上角顯示編號（01-16）
  - 外觀不透露好壞，僅憑實驗判斷

### 組裝與測試
- **拖曳操作**：拖曳元件到對應類型的插槽
- **替換機制**：插槽被占用時，新件放入，舊件自動返回原位
- **即時判定**：同一電路四個插槽皆為正常件 → 燈泡亮；否則熄滅
- **觸控支援**：完整支援觸控螢幕拖曳操作

### 故障診斷系統
- **右側故障區**：專門用於放置診斷出的故障零件
- **步驟計數器**：顯示總共使用了多少步驟（每次拖曳計數一次）
- **檢查邏輯**：只需找出所有故障零件即可
- **檢查反饋**：
  - 未放入零件：提示將故障零件拖曳至故障區
  - 有誤判：顯示正常零件被誤判數量（紅色）
  - 部分正確：顯示已找出 M/N 個故障零件（藍色）
  - 完全正確：找出全部故障零件（綠色）
- **故障零件分配**：總共 `broken` 個故障零件，隨機分配到各種類型
  - 例如：broken=4 時，可能是 電池2個、電線0個、燈座1個、燈泡1個
  - 保證每種類型至少有 `lit` 個正常零件（用於組成保證亮燈的電路）

## URL 參數

- `seed`：整數，控制隨機種子（每次載入自動生成新種子，可重現相同配置）
- `groups`：電路組數（預設 4，支援動態網格佈局）
- `broken`：故障零件總數（預設 4，隨機分配到各種類型）
- `lit`：預設載入時保證會亮燈的電路數（預設 1，需配合 demo=1）
- `demo`：1/0，是否載入時自動填滿所有插槽（預設 1）
- `debug`：1/0，開發用面板，顯示零件狀態（預設 0）

## 使用範例

```
# 預設示範模式（自動填滿，4個故障零件，1組保證亮燈）
?groups=4&broken=4&lit=1&demo=1&debug=0

# 簡單模式（較少故障零件）
?groups=4&broken=2&demo=1&lit=1

# 困難模式（更多電路，更多故障零件）
?groups=6&broken=8&demo=1&lit=2

# 練習模式（手動組裝）
?groups=4&broken=4&demo=0&lit=1

# 除錯模式（顯示所有零件狀態）
?groups=4&broken=4&demo=1&debug=1
```

## 檔案結構

- `index.html`：頁面骨架與 SVG 舞台容器
- `styles.css`：
  - 扁平幾何風格設計
  - 類型專屬顏色系統（高彩度元件 + 低彩度插槽）
  - 分類區域樣式（故障區紅色主題）
  - 觸控優化樣式
- `script.js`：
  - 隨機生成系統（可控種子）
  - 動態佈局計算（自適應網格）
  - 完整拖放系統（滑鼠+觸控）
  - 電路狀態判定
  - 故障診斷邏輯
  - Debug 面板

## 技術特點

### 佈局系統
- **主要區域**（左側 ~1100px）：
  - 電路區域（上方 48%）：動態網格，自動計算行列數
  - 零件池（下方 52%+）：固定原位系統，零件會返回 home 位置
- **分類區域**（右側 280px）：
  - 檢查按鈕（頂端）
  - 說明文字
  - 步驟計數器
  - 結果文字
  - 故障區塊（大面積可放置區）

### 拖曳系統
- **Pointer Events**：統一處理滑鼠和觸控
- **Delta Movement**：累積式移動計算，避免抖動
- **Hit Testing**：暫時隱藏所有零件以正確檢測底層插槽
- **類型檢查**：只有對應類型的零件能放入插槽
- **Origin 追蹤**：記錄零件來源（pool/circuit-N/zone-broken）

### 顏色系統
```css
/* 零件（高彩度） */
--bg-battery: #dbeafe  /* 藍色 */
--bg-wire: #fde68a     /* 琥珀色 */
--bg-socket: #fce7f3   /* 粉色 */
--bg-bulb: #dcfce7     /* 綠色 */

/* 插槽（低彩度，相同色相） */
--bg-slot-battery: #eff6ff
--bg-slot-wire: #fffbeb
--bg-slot-socket: #fdf4f8
--bg-slot-bulb: #f0fdf4
```

## 遊戲流程

1. **初始狀態**：每次載入自動生成新種子，根據 `demo` 參數決定是否自動填滿
2. **組裝測試**：拖曳零件到插槽，觀察燈泡是否點亮
3. **診斷推理**：
   - 不能用排除法（不是所有不亮電路的零件都是壞的）
   - 需要透過交換零件測試來找出真正的故障零件
   - 故障零件數量較少（預設 4 個），分配不均勻
4. **分類診斷**：將診斷出的故障零件拖曳到右側故障區
5. **檢查結果**：點擊檢查按鈕，系統驗證是否正確找出所有故障零件
6. **重置或換題**：使用工具列按鈕重置或生成新題目（自動新種子）

## 注意事項

- **網格自適應**：`groups` 非 4 時，版面自動形成近似正方網格（如 6 組 = 3×2）
- **故障零件分配**：`broken` 個故障零件隨機分配到各類型，分配不均勻增加挑戰性
- **最小正常件保證**：每種類型至少有 `lit` 個正常零件，確保能組成保證亮燈的電路
- **Lit 參數**：只在 `demo=1` 時有效，保證前 N 組電路使用全好件並點亮
- **步驟計數**：每次拖曳操作（放入插槽或故障區，或返回 pool）都會計數
- **自動新種子**：每次重新載入頁面都會生成新的隨機配置
- **觸控滾動**：body 允許 pan-y（垂直滾動），拖曳區禁用所有觸控手勢
- **視窗自適應**：SVG 高度會根據視窗大小調整，避免頁面滾動
